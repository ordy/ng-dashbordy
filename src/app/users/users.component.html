<p-toast></p-toast>

<div class="card-container">
  <p-card header="Users">

    <p-toolbar styleClass="p-mb-4">
      <ng-template pTemplate="left">
        <button pButton pRipple label="New User" icon="pi pi-plus" class="p-button-success p-mr-2" (click)="addUser()"></button>
        <button pButton pRipple icon="pi pi-pencil" class="p-button-warning p-mr-2" [disabled]="!selectedUser" (click)="editUser(selectedUser)"></button>
        <button pButton pRipple icon="pi pi-trash" class="p-button-danger" [disabled]="!selectedUser" (click)="deleteUser()"></button>
      </ng-template>
    </p-toolbar>

    <p-table [value]="usersTable" selectionMode="single" [autoLayout]="true" [(selection)]="selectedUser" dataKey="email">
      <ng-template pTemplate="header">
        <tr>
          <th>Name</th>
          <th>email</th>
          <th>Phone</th>
          <th>City</th>
          <th>Last Log</th>
          <th>Admin</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-user>
        <tr [pSelectableRow]="user">
          <td>{{user.firstname}} {{user.surname}}</td>
          <td>{{user.email}}</td>
          <td>{{user.phone}}</td>
          <td>{{user.city}}</td>
          <td>{{user.lastLogged?.toLocaleDateString()}}</td>
          <td>{{user.isAdmin}}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="summary">
        <div class="p-d-flex p-ai-center p-jc-between">
          There are {{usersTable ? usersTable.length : 0 }} users in the database.
        </div>
      </ng-template>
    </p-table>

    <p-dialog [(visible)]="showDialog" [style]="{width: '650px'}" header="User Details" [modal]="true" styleClass="p-fluid edit-dialog">
      <ng-template pTemplate="content">
        <div class="p-field">
          <label for="firstname-input">Firstname</label>
          <input type="text" pInputText id="firstname-input" [(ngModel)]="dialogUser.firstname" required autofocus />
          <small class="p-invalid" *ngIf="submitted && !dialogUser.firstname">Firstame is required.</small>
        </div>
        <div class="p-field">
          <label for="surname-input">Surname</label>
          <input id="surname-input" pInputText [(ngModel)]="dialogUser.surname" required />
          <small class="p-invalid" *ngIf="submitted && !dialogUser.surname">Surname is required.</small>
        </div>
        <div class="p-field">
          <label for="email-input">Email</label>
          <input id="email-input" pInputText [(ngModel)]="dialogUser.email" required />
          <small class="p-invalid" *ngIf="submitted && !dialogUser.email">email is required.</small>
        </div>
        <div class="p-field">
          <label for="phone-input">Phone</label>
          <input id="phone-input" pInputText [(ngModel)]="dialogUser.phone" />
        </div>
        <div class="p-field">
          <label for="city-input">City</label>
          <input id="city-input" pInputText [(ngModel)]="dialogUser.city" />
        </div>
        <div class="p-field">
          <label for="admin-input">Role</label>
          <input id="admin-input" pInputText [(ngModel)]="dialogUser.isAdmin" />
        </div>
      </ng-template>
      <ng-template pTemplate="footer">
        <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
        <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text" (click)="saveUser()"></button>
      </ng-template>
    </p-dialog>
  </p-card>
  <p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>
  <button pButton label="Log User" class="p-button-text" (click)="logUser()"></button>

</div>
